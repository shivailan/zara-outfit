<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/style.css">
    <title>ZARA — DIGITAL FASHION</title>
</head>
<body>
  
    <%- include('partials/navbar') %>

    <header id="hero">
        <div class="hero-content">
            <span class="tag">SPRING 2026</span>
            <h1>DIGITAL<br>FASHION</h1>
        </div>
    </header>

    <section id="catalog">
        <div class="grid-header">
            <h2>LA SÉLECTION</h2>
            <p>Cliquez pour ajouter à votre studio</p>
        </div>
        <div class="luxury-grid">
            <% products.forEach((p, i) => { %>
                <div class="card <%= i % 3 === 0 ? 'tall' : '' %>" onclick="save('<%= p.image %>', <%= p.priceValue %>)">
                    <div class="img-box">
                        <img src="<%= p.image %>" alt="">
                        <div class="overlay"><span>+ AJOUTER</span></div>
                    </div>
                    <div class="info">
                        <span class="n"><%= p.name %></span>
                        <span class="p"><%= p.priceText %></span>
                    </div>
                </div>
            <% }) %>
        </div>
    </section>

<script>
// Dans index.ejs, assure-toi que ta fonction reçoit l'ID ASOS
function save(img, price, asosId) {
    let outfit = JSON.parse(localStorage.getItem('myOutfit')) || [];
    const params = new URLSearchParams(window.location.search);
    const catId = params.get('cat') || '7616';

    const newItem = {
        img: img,
        price: parseFloat(price),
        catId: catId,
        asosId: asosId, // ON AJOUTE L'ID ICI
        x: 0, y: 0
    };

    // Remplacement si catégorie déjà présente
    const index = outfit.findIndex(item => item.catId === catId);
    if (index > -1) outfit[index] = newItem;
    else outfit.push(newItem);

    localStorage.setItem('myOutfit', JSON.stringify(outfit));
    
    // Animation du point rouge dans la navbar pour montrer qu'il y a du nouveau
    document.querySelector('.dot').style.transform = 'scale(1.5)';
    setTimeout(() => { document.querySelector('.dot').style.transform = 'scale(1)'; }, 300);
}
</script>
</body>
</html>